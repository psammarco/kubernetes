apiVersion: apps/v1
kind: Deployment
metadata:
  name: dnsmax
spec:
  replicas: 3
  selector:
    matchLabels:
      app: dnsmax
  template:
    metadata:
      labels:
        app: dnsmax
    spec:
      dnsPolicy: "None"  # Set to "None" to use custom DNS settings
      dnsConfig:
        nameservers:
        # Replace with the IP of the CoreDNS service.
        # If DNS server is unreachable, make sure it is not an issue with the pods.
        - 10.43.229.169 
        searches:
        - intranet.local  # replace with yours
      containers:
      - name: dnsutils
        image: registry.k8s.io/e2e-test-images/jessie-dnsutils:1.3
        command: ["sleep", "infinity"]  # Keep the container running
        imagePullPolicy: IfNotPresent
      restartPolicy: Always

## A Service is needed for intrapods DNS resolution to work
---
apiVersion: v1
kind: Service
metadata:
  name: dnsmax
spec:
  selector:
    app: dnsmax 
  ports:
    - protocol: TCP
      port: 8089

# Pods part of the same Service should be reachable as:
# podname.servicename.namespacename.svc.intranet.local
