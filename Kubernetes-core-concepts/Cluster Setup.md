# Cluster Setup
## Install Controlplane

There are two VMs controlplane and node-summer , create a two Node Kubeadm Kubernetes cluster with them.

Kubeadm, kubelet and kubectl are already installed.

First make controlplane the controlplane. For this we should:

    Use Kubernetes version v1.31.0
    Use a Pod-Network-Cidr of 192.168.0.0/16
    Ignore preflight errors for NumCPU and Mem
    Copy the default kubectl admin.conf to /root/.kube/config


Tip 1

https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm

Tip 2

Use these arguments:

--kubernetes-version=1.31.0
--pod-network-cidr 192.168.0.0/16
--ignore-preflight-errors=NumCPU
--ignore-preflight-errors=Mem


Tip 3

The default Kubelet config generated by Kubeadm is found at:

/etc/kubernetes/admin.conf


Solution

We are already on controlplane , so this will become the controlplane:

kubeadm init --kubernetes-version=1.31.0 --pod-network-cidr 192.168.0.0/16 --ignore-preflight-errors=NumCPU --ignore-preflight-errors=Mem

cp /etc/kubernetes/admin.conf /root/.kube/config

kubectl version

kubectl get pod -A


## Add Worker Node

Join node-summer as a worker Node to the cluster.

Tip 1

https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#join-nodes

Tip 2

Use the command printed out by the kubeadm join command.

Solution

# generate a new token OR use the one printed out "kubeadm init" before
kubeadm token create --print-join-command

ssh node-summer
    kubeadm join 172.30.1.2:6443 --token ...
    exit


Now we should see our two Nodes:

kubectl get node

